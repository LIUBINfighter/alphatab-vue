
# 暗色主题功能 - 需求与分阶段计划

## 1. 项目目标

为 AlphaTab 曲谱网站添加一个全局暗色主题模式，允许用户根据其使用环境或个人偏好，在浅色和深色主题之间进行切换。

## 2. 总体需求

全局暗色主题模式需要满足以下核心要求：

* **全面的界面适配**：
    * 网站的各个页面元素，包括背景、字体颜色、按钮等，都应能整体切换至暗色风格，以适应光线较暗的环境。
    * AlphaTab 曲谱的显示区域也必须能够适应暗色模式，确保其在暗色背景下清晰可见，避免视觉上的突兀感。
    * 目标之一是全面适配 `DarkDefault` 风格的 CSS。 (待办)
* **智能与手动切换**：
    * 默认情况下，主题应能跟随用户操作系统的设置（例如 macOS 或 Windows 的深色模式）自动切换。
    * 同时，用户也应能够通过界面控件手动选择并切换主题。
* **流畅的用户体验**：
    * 主题切换过程应保证自然平滑，避免出现闪屏或中断用户当前操作等不良体验。
* **状态持久化**：
    * 用户选择的主题设置（无论是自动检测还是手动选择）需要被保存，确保用户在下次访问网站时仍然保持其偏好的主题。
* **可维护与扩展性**：
    * 样式的实现结构应清晰、易于理解和维护，为将来可能进行的“自定义主题”等扩展功能提供便利。

## 3. 主要开发任务

为实现上述需求，主要开发工作包括：

1.  **构建主题切换核心功能**：
    * 实现对操作系统暗色模式的监听。
    * 提供一个用户界面开关，允许用户手动切换浅色/暗色主题。
    * 确保用户的选择能够被记住并在后续访问中生效。
2.  **实现页面样式的动态化**：
    * 采用例如 CSS 变量等技术，使网站的背景、字体颜色等基础样式能够根据当前主题动态改变。
3.  **适配 AlphaTab 曲谱区域的暗色模式**：
    * 研究 AlphaTab 是否提供官方的颜色配置 API，如果支持，则优先使用 API 进行调整。
    * 如果 AlphaTab 不直接支持颜色设置，则需要探索其他方案，例如通过修改其渲染出的 SVG 元素样式或注入自定义 CSS 来实现曲谱区域的暗色外观。
4.  **保障交互的平滑性**：
    * 在主题切换时，特别关注曲谱的重绘过程，确保不会出现闪烁或卡顿，维持良好的用户体验。
5.  **确保代码的可维护性**：
    * 组织好样式代码结构，使其易于管理和未来的功能迭代。

## 4. 分阶段实施计划

为了逐步推进并快速验证核心功能，我们将采用分阶段的开发策略。

### 第一阶段：核心功能实现

此阶段的目标是优先完成曲谱暗色适配和全局主题切换按钮这两个关键功能。

#### ✅ 目标 1：曲谱区域支持暗色主题

* 确保 AlphaTab 渲染出的曲谱内容（如音符、线条等）在暗色模式下依然清晰可辨，例如通过将背景调暗，同时调亮音符和线条颜色来实现。
* 优先尝试使用 AlphaTab 提供的颜色设置 API 进行调整。
* 若 AlphaTab 不提供相关 API，则研究通过修改 SVG 属性或注入 CSS 的方式来实现曲谱的暗色视觉效果。

#### ✅ 目标 2：添加主题切换按钮

* 在网站的用户界面上增加一个明确的“浅色 / 暗色”主题切换按钮。
* 用户点击该按钮后，网站的整体主题（包括曲谱样式）应能即时响应并更新。
* 用户当前的主题选择需要通过 `localStorage` 或类似机制进行本地存储，以便在页面刷新或下次访问时依然生效。

完成这两个核心目标后，网站的曲谱展示和主要页面将初步具备暗色主题的支持，从而提升用户在夜间等低光环境下的使用体验。

### 后续阶段：

* **全面样式覆盖**：在第一阶段基础上，逐步完善网站所有组件和页面的暗色主题适配。
* **操作系统主题同步优化**：细化和测试操作系统主题同步的稳定性和即时性。
* **自定义主题扩展**：根据第一阶段清晰的样式结构，探索未来支持更多自定义主题的可能性。

## 5. 开发注意事项

* **AlphaTab 兼容性调研**：在着手适配 AlphaTab 曲谱区域的暗色模式前，需仔细调研其对自定义样式的支持程度。如果发现 AlphaTab 本身在深色样式支持方面存在不足，应主动寻求解决方案（如注入 SVG 样式、重新挂载 CSS 等），并及时反馈是否需要向 AlphaTab 官方提交 issue 或考虑 fork 项目进行定制化开发。
* **开发过程记录**：整个功能的开发过程建议使用 Markdown 格式进行详细记录，便于团队协作和后续维护。

---